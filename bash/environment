# set terminal lang to something useful
export LANG="en_US.utf8"
export LC_ALL="en_US.utf8"
export LC_MONETARY="de_CH.utf8"
export LC_PAPER="de_CH.utf8"

# set editor
export EDITOR=vim

function prepend
{
    PATH_VAR=$1
    PPATH=$2
    PATH_CONTENTS=${!PATH_VAR}

    if [[ "$PATH_CONTENTS" != *"$PPATH"* ]]; then
        eval export $PATH_VAR=$PPATH:$PATH_CONTENTS
    fi
}
function append
{
    PATH_VAR=$1
    PPATH=$2
    PATH_CONTENTS=${!PATH_VAR}

    if [[ "$PATH_CONTENTS" != *"$PPATH"* ]]; then
        eval export $PATH_VAR=$PATH_CONTENTS:$PPATH
    fi
}

# assume vim stuff is always in /usr/share/vim
export VIM=/usr/share/vim

# new barrelfish env

prepend PATH /home/netos/tools/bin
prepend PATH /home/netos/tools/gem5/gem5/build/ARM

# ~/.local/ paths
prepend PATH $HOME/.local/override-bin
append PATH $HOME/.local/bin
append PATH $HOME/.local/opt/fast-export
append PATH $HOME/.local/opt/git-achievements

# Xeon PHI gcc
append PATH /opt/mpss/3.4/sysroots/x86_64-mpsssdk-linux/usr/bin/k1om-mpss-linux

if [[ $HOSTNAME = emmentaler* ]]; then
    append PATH /local/gerbesim/.local/bin
fi

if [[ $HOSTNAME == "sgd-dalcoi7-09" ]]; then
    append PATH /local/gerbesim/tools/arcanist/arcanist/bin
    # armv8 toolchain
    append PATH /local/gerbesim/tools/apm-aarch64/8.0.5-le/bin
    append PATH /home/netos/tools/linaro/gcc-linaro-4.9-2014.11-x86_64_aarch64-elf/bin
    echo $DBUS_SESSION_BUS_ADDRESS > /local/gerbesim/.dbus_session_bus_address
    #append PATH /local/gerbesim/.local/bin
    export RUST_SRC_PATH=/local/gerbesim/src/rust/src
    prepend PATH /opt/openocd-potenza/bin
fi

export CCACHE_DIR=/local/gerbesim/.ccache

if [[ "$CFLAGS" != *"-std="* ]]; then
    export CFLAGS="$CFLAGS -std=gnu11 -O2 -Wall -Wshadow -Wmissing-field-initializers -Wredundant-decls -Wstrict-prototypes -Wold-style-definition -Werror"
fi

# git author name and email mostly for sudo -E
if [[ $HOSTNAME == emmentaler* ]]; then
    export GIT_AUTHOR_NAME="Simon Gerber"
    export GIT_AUTHOR_EMAIL="simon.gerber@inf.ethz.ch"
fi

export TIG_LS_REMOTE="/home/gerbesim/.local/bin/git-ls-remote-sane ."

# set wine prefix for workstation
if [[  $HOSTNAME == "sgd-dalcoi7-09" ]]; then
    export WINEPREFIX=/local/gerbesim/wine32
    export LD_LIBRARY_PATH=/home/gerbesim/.local/lib
    export ASAN_SYMBOLIZER_PATH=/usr/bin/llvm-symbolizer-3.4
fi

# disable lesspipe stuff, avoids
# http://seclists.org/fulldisclosure/2014/Nov/74
unset LESSOPEN
unset LESSCLOSE

# set CDPATH for workstation
#if [[ $HOSTNAME == "sgd-dalcoi7-09" ]]; then
#	export CDPATH=".:/local/gerbesim"
#fi

# try to classify SSH connections for stuff like vim-airline etc
if [ -n "$SSH_CONNECTION" ]; then
	ssh_remote=$(echo $SSH_CONNECTION | cut -f 1 -d' ' | nslookup | grep "name =" | cut -d= -f2 | cut -d' ' -f2)
	case $ssh_remote in
		sgd-dalcoi7-09*) export TERM_HAS_AIRLINE_SYMS=1;;
		*) export TERM_HAS_AIRLINE_SYMS=0;;
	esac
else
	# local, assume we have airline syms.
	export TERM_HAS_AIRLINE_SYMS=1
fi

. ~/.local/bash_environment
